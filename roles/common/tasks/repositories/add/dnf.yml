# code: language=ansible
---

- name: "Common | Repositories | Add | Dnf / Yum | GPG Keys"
  ansible.builtin.rpm_key:
    key: "{{ item }}"
    state: present
  with_items: "{{ _common_repositories_add_ | local.sys.config_sub_keys(key='gpg', flatten=True) }}"
  when:
    - item is url
  become: true
  tags:
    - common
    - common-repositories
    - common-repositories-add
    - common-repositories-gpg

- name: "Common | Repositories | Dnf / Yum | Add repository"
  ansible.builtin.template:
    src: "repositories/dnf.repo.j2"
    dest: "/etc/yum.repos.d/{{ item.key }}.repo"
    owner: "root"
    group: "root"
    mode: "0644"
    backup: false
  with_dict: "{{ _common_repositories_add_ }}"
  notify:
    - Update dnf cache
  become: true
  tags:
    - common
    - common-repositories
    - common-repositories-add
